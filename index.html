<!-- Add tags -->
<!-- add option to expand/collapse all -->
<!-- add way to filter by tag -->
<!-- add way to sort by most recent/oldest -->
<!--  https://stackoverflow.com/questions/2033711/how-can-i-attach-meta-data-to-a-dom-node -->
<!-- make reddit fetching script into gh action -->
<!-- when hide expanded, need to hide story too -->
<!-- need to handle story with multiple categories -->
<!--  -->
<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>My test page</title>
  <link rel="stylesheet" href="index.css">
</head>

<body>

  <h1>Short Stories</h1>

  <input type="checkbox" checked="true" id="checkall" onclick="toggleall(this);" />Show all<br />
  <input type="checkbox" checked="true" onclick="togglecheck(this, 'fantasy')" ; />Fantasy<br />
  <input type="checkbox" checked="true" onclick="togglecheck(this, 'humor')" ; />Humor<br />
  <input type="checkbox" checked="true" onclick="togglecheck(this, 'scifi')" ; />SciFi<br />

  <button data-fantasy="true" class="collapsible filterDiv fantasy">Fantasy story</button>
  <div class="content">
    <p>hijklmnop</p>
  </div>
  <button data-fantasy="true" class="collapsible filterDiv fantasy humor">Funny fantasy story</button>
  <div class="content">
    <p>hijklmnop</p>
  </div>
  <button data-fantasy="true" class="collapsible filterDiv fantasy">Fantasy story</button>
  <div class="content">
    <p>qrstuvwxyz</p>
  </div>

  <div id="stories"></div>

  <script>

    var storyParent = document.getElementById("stories");
    var storydir = '/Users/skedwards88/projects/ShortStories/story-data/stories'
    for (i = 0; i < 3; i++) {
      var newDiv = document.createElement("div")
      const newContent = document.createTextNode("Hi there and greetings!"); 
      newDiv.appendChild(newContent);  
      storyParent.appendChild(newDiv);  

    }


    var coll = document.getElementsByClassName("collapsible");
    var i;

    for (i = 0; i < coll.length; i++) {
      coll[i].addEventListener("click", function () {
        this.classList.toggle("active");
        var content = this.nextElementSibling;
        if (content.style.maxHeight) {
          content.style.maxHeight = null;
        } else {
          content.style.maxHeight = content.scrollHeight + "px";
        }
      });
    }

    function show(category) {
      var x = document.getElementsByClassName("filterDiv");

      for (i = 0; i < x.length; i++) {
        if (x[i].classList.contains(category)) {
          x[i].classList.add("show");
        }
      }
    }

    function hide(category) {
      var allcats = ["scifi", "fantasy", "humor"];
      var x = document.getElementsByClassName("filterDiv");

      for (i = 0; i < x.length; i++) {
        if (x[i].classList.contains(category)) {

          var mycats = allcats.filter(thesecats);
          function thesecats(value, index, array) {
            return x[i].classList.contains(value);
          }
          console.log(mycats);
          if (mycats.length === 1) {
            x[i].classList.remove("show");
          }
        }
      }
    }

    function showall() {
      var x = document.getElementsByClassName("filterDiv");

      for (i = 0; i < x.length; i++) {
        x[i].classList.add("show");
      }
    }

    function hideall() {
      var x = document.getElementsByClassName("filterDiv");

      for (i = 0; i < x.length; i++) {
        x[i].classList.remove("show");
      }
    }

    function togglecheck(source, category) {
      if (source.checked) {
        console.log('showing ' + category);
        show(category);
      } else {
        console.log('hiding ' + category)
        hide(category);
        // uncheck the show all box
        var checkall = document.getElementById("checkall")
        console.log(checkall.checked);
        checkall.checked = false;
        console.log(checkall.checked);
      }
    }

    function toggleall(source) {
      console.log(source.checked);

      if (source.checked) {
        console.log('showing all');
        showall();
      } else {
        console.log('showing none');
        hideall();
      }

      var checkboxes = document.querySelectorAll('input[type="checkbox"]');
      for (var ii = 0; ii < checkboxes.length; ii++) {
        if (checkboxes[ii] != source)
          checkboxes[ii].checked = source.checked;
      }


    }

    showall()

    function inject(data) {
      console.log('injecting')
      var storyParent = document.getElementById("stories");
      var newDiv = document.createElement("div");
      // const newContent = document.createTextNode("Hi there and greetings!"); 
      txt = JSON.stringify(data);
      newDiv.appendChild(txt);  
      storyParent.appendChild(newDiv);  

    }

    console.log('PREF')
    fetch('story-data/stories.json')
      .then(response => response.json())
      .then(data => inject(data));
    console.log('POSTF')
  </script>

</body>

</html>